<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jiles-Atherton Magnetic Hysteresis Web App</title>
    <script src="chart.js"></script>
    <style>
        body {
            background: #f4f6fa;
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h2 {
            text-align: center;
            margin-top: 30px;
            color: #333;
        }
        #sliders {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
            max-width: 900px;
            margin: 30px auto 30px auto;
            padding: 30px 40px 20px 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px 40px;
            justify-content: center;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 320px;
        }
        .slider-label {
            font-weight: 500;
            color: #444;
            width: 70px;
        }
        input[type="range"] {
            width: 180px;
            accent-color: #1976d2;
            margin: 0 10px;
        }
        #bhChart, #energyChart {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
            margin-bottom: 20px;
        }
        .charts-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            gap: 60px;
            margin-bottom: 40px;
        }
        @media (max-width: 1700px) {
            .charts-row {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }
        }
    </style>
</head>
<body>
    <h2>Jiles-Atherton Magnetic Hysteresis Model</h2>
    <div id="sliders">
        <div class="slider-container">
            <span class="slider-label">cr</span>
            <input type="range" id="cr" min="0.005" max="0.9999" step="0.001" value="0.1">
            <span id="cr_val">1</span>
        </div>
        <div class="slider-container">
            <span class="slider-label">Ms</span>
            <input type="range" id="Ms" min="10000" max="1000000" step="1" value="100000">
            <span id="Ms_val">1</span>
        </div>
        <div class="slider-container">
            <span class="slider-label">a</span>
            <input type="range" id="a" min="100" max="2000" step="1" value="1000">
            <span id="a_val">1</span>
        </div>
        <div class="slider-container">
            <span class="slider-label">kp</span>
            <input type="range" id="kp" min="100" max="10000" step="1" value="300">
            <span id="kp_val">1</span>
        </div>
        <div class="slider-container">
            <span class="slider-label">alpha</span>
            <input type="range" id="alpha" min="0.00001" max="0.1" step="0.000001" value="0.0001">
            <span id="alpha_val">1</span>
        </div>

        <div class="slider-container">
            <span class="slider-label">dt</span>
            <input type="range" id="dt" min="0.0001" max="0.003" step="0.00001" value="0.001">
            <span id="dt_val">0.01</span>
        </div>
    </div>
    <div class="charts-row">
        <canvas id="bhChart" width="800" height="700"></canvas>
        <canvas id="energyChart" width="800" height="700"></canvas>
    </div>
    <script src="javascript.js"></script>
    <script>
        // Helper to get slider values
        function getParams() {
            return [
                parseFloat(document.getElementById('cr').value),
                parseFloat(document.getElementById('Ms').value),
                parseFloat(document.getElementById('a').value),
                parseFloat(document.getElementById('kp').value),
                parseFloat(document.getElementById('alpha').value)
            ];
        }

        function getDt() { return parseFloat(document.getElementById('dt').value); }

        // Update slider value display
        function updateSliderDisplays() {
            ['cr','Ms','a','kp','alpha','dt'].forEach(id => {
                document.getElementById(id + '_val').textContent = document.getElementById(id).value;
            });
        }

        // Plotting
        let chart;
        let energyChart;

        function plotBH(B, H) {
            const data = H.map((h, i) => ({x: h, y: B[i]}));
            if (chart) {
                chart.destroy();
            }
            chart = new Chart(document.getElementById('bhChart').getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '',
                        data: data,
                        borderColor: 'blue',
                        showLine: true,
                        pointRadius: 0,
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: false,
                    animation: false,
                    plugins: {
                        title: { display: false },
                        legend: { display: false }
                    },
                    scales: {
                        x: { type: 'linear', title: { display: true, text: 'H in kA/m' } },
                        y: { title: { display: true, text: 'B in Tesla' } }
                    }
                }
            });
        }

        function plotEnergy(A, E) {
            const data = A.map((a, i) => ({x: a, y: Math.max(1e-12, -E[i] * 1e-6)}));
            if (energyChart) {
                energyChart.destroy();
            }
            energyChart = new Chart(document.getElementById('energyChart').getContext('2d'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '',
                        data: data,
                        borderColor: 'red',
                        showLine: true,
                        pointRadius: 3,
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: false,
                    animation: false, 
                    plugins: {
                        title: { display: false },
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Amplitude' },
                            min: 0.09,
                            max: 25
                        },
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: 'Energy' },
                            min: 0
                        }
                    }
                }
            });
        }

        // Main update function
        function updatePlot() {
            updateSliderDisplays();
            const params = getParams();
            const dt = getDt();
            const {B, H, E, A} = JAModelws(params, dt);

            plotBH(B, H);
            plotEnergy(A, E);
        }

        // Attach event listeners
        ['cr','Ms','a','kp','alpha','dt'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePlot);
        });

        // Initial plot
        updatePlot();
    </script>
</body>
</html>